# YouYou 业务逻辑测试报告模板

## 测试概览

- **测试日期**: [YYYY-MM-DD HH:MM:SS]
- **测试环境**: [开发/测试/生产]
- **测试执行人**: [姓名]
- **测试工具**: scripts/test_business_logic.py

## 测试统计

| 指标 | 数值 |
|-----|------|
| 总测试数 | XX |
| 通过数量 | XX |
| 失败数量 | XX |
| 通过率 | XX% |
| 总耗时 | XX.XXs |

## 测试结果详情

### 1. 基础功能测试

#### 1.1 健康检查端点
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试内容**: 验证 /api/v1/system/health 端点可访问
- **预期结果**: 返回 200 状态码和健康状态
- **实际结果**: [描述实际结果]
- **备注**: [如有异常,记录详细信息]

#### 1.2 配置端点
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试内容**: 验证 /api/v1/system/config 端点返回正确配置
- **预期结果**: 返回包含 API Base、模型配置等信息
- **实际结果**: [描述实际结果]

### 2. 物品记录测试

#### 2.1 记录单个物品
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "测试钥匙在测试桌子上"
- **预期行为**:
  - Supervisor 正确路由到 ItemAgent
  - ItemAgent 调用 remember_item_location 工具
  - 数据库创建新记录
  - 返回确认消息
- **实际输出**: [记录实际响应]
- **数据验证**: 检查数据库是否正确存储

#### 2.2 重复记录相同位置
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**:
  1. "测试手机在测试背包"
  2. "测试手机在测试背包" (重复)
- **预期行为**:
  - 第一次记录成功
  - 第二次识别为重复,仅更新访问时间
  - 返回"确实在"或"已经在"等确认消息
- **实际输出**: [记录响应]
- **数据一致性**: 验证 move_count 未增加

#### 2.3 更新物品位置
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**:
  1. "测试笔记本在测试客厅"
  2. "测试笔记本在测试卧室" (不同位置)
- **预期行为**:
  - 识别为位置变更
  - 记录历史记录到 item_history 表
  - move_count 增加
  - 返回"已移动"等消息
- **实际输出**: [记录响应]
- **历史记录**: 验证 item_history 表是否有新记录

#### 2.4 复杂物品名称
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试用例**:
  - "MacBook Pro 笔记本电脑在测试书房"
  - "iPhone 15 Pro Max手机在测试床头柜"
  - "测试护照在测试保险柜"
- **预期行为**: 正确解析复杂物品名称和位置
- **实际结果**: [记录处理情况]

### 3. 物品查询测试 - 五级查询策略

#### 3.1 精确匹配查询 (Level 1)
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **前置条件**: 记录"测试钱包在测试抽屉"
- **测试输入**: "测试钱包在哪？"
- **预期行为**:
  - 使用 normalized_name 精确匹配
  - 直接从数据库返回结果
  - match_type = "exact"
- **实际输出**: [记录响应]
- **查询日志**: [记录数据库查询策略]

#### 3.2 别名匹配查询 (Level 2)
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **前置条件**: 记录"测试笔记本电脑在测试办公桌"
- **测试输入**: "测试电脑在哪？" (使用别名)
- **预期行为**:
  - Level 1 精确匹配失败
  - Level 2 别名匹配成功
  - match_type = "alias"
- **实际输出**: [记录响应]
- **匹配说明**: "电脑" 是 "笔记本电脑" 的别名

#### 3.3 全文搜索查询 (Level 3)
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **前置条件**: 记录"测试充电器在测试床头"
- **测试输入**: "测试充电在哪？" (部分匹配)
- **预期行为**:
  - Level 1-2 失败
  - Level 3 FTS5 全文搜索成功
  - match_type = "fuzzy"
- **实际输出**: [记录响应]

#### 3.4 关键词模糊匹配 (Level 4)
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **前置条件**: 记录"测试摩托车钥匙在测试车库"
- **测试输入**: "测试摩托车在哪？"
- **预期行为**:
  - Level 1-3 失败
  - Level 4 关键词匹配成功
  - 提取关键词: ["摩托车", "钥匙"]
  - match_type = "keyword_fuzzy"
- **实际输出**: [记录响应]
- **关键词提取**: [记录提取的关键词列表]

#### 3.5 Zep 语义搜索兜底 (Level 5)
- **状态**: ✓ PASS / ✗ FAIL / ⚠ SKIP (Zep 未配置)
- **耗时**: X.XXs
- **前置条件**:
  - 在对话中提及物品但未明确记录
  - 例如: "我提到过测试Zep物品放在某个地方"
- **测试输入**: "测试Zep物品在哪？"
- **预期行为**:
  - Level 1-4 数据库查询全部失败
  - Level 5 Zep 语义搜索历史对话
  - 返回相关历史对话片段
  - match_type = "zep_semantic"
- **实际输出**: [记录响应]
- **Zep 状态**: [是否启用 Zep]

#### 3.6 未找到物品
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "测试时光机在哪？" (不存在的物品)
- **预期行为**:
  - 所有查询级别失败
  - 返回友好的"未找到"消息
  - status = "not_found"
- **实际输出**: [记录响应]

### 4. 列出物品测试

#### 4.1 列出所有物品
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **前置条件**: 至少记录 2 个物品
- **测试输入**: "我记录了哪些物品？"
- **预期行为**:
  - 调用 list_all_items 工具
  - 返回物品列表(物品名 + 位置)
  - 按更新时间倒序排列
- **实际输出**: [记录响应,包含物品数量]

### 5. Supervisor 路由逻辑测试

#### 5.1 路由到 ItemAgent
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试用例**:
  - "测试路由物品在测试位置" (记录)
  - "测试路由物品在哪？" (查询)
  - "查看我记录了哪些物品" (列表)
- **预期行为**:
  - Supervisor 识别关键词: "在"、"哪"、"记录"
  - 调用 item_agent_tool
  - 传递完整原始消息(不修改)
- **实际结果**: [记录路由决策]
- **关键验证**: 消息未被修改或转写

#### 5.2 路由到 ChatAgent
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试用例**:
  - "你好" (问候)
  - "今天天气怎么样？" (一般问题)
  - "什么是人工智能？" (知识问答)
- **预期行为**:
  - Supervisor 识别为非物品相关
  - 调用 chat_agent_tool
- **实际结果**: [记录路由决策]

### 6. ChatAgent 对话测试

#### 6.1 简单问候
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "你好"
- **预期行为**: 返回友好的问候语
- **实际输出**: [记录响应]

#### 6.2 一般性问题
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "你能做什么？"
- **预期行为**: 介绍自己的功能
- **实际输出**: [记录响应]

### 7. 会话历史和上下文测试

#### 7.1 代词引用
- **状态**: ✓ PASS / ✗ FAIL / ⚠ PARTIAL
- **耗时**: X.XXs
- **测试流程**:
  1. "测试上下文钥匙在测试玄关"
  2. "它在哪里？" (使用代词"它")
- **预期行为**:
  - Session History 提供上下文
  - Agent 理解"它"指代"测试上下文钥匙"
- **实际结果**: [记录是否成功解析代词]
- **备注**: 取决于模型的上下文理解能力

#### 7.2 多轮对话
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试流程**:
  1. "你好"
  2. "我刚才说什么了？"
  3. "谢谢"
- **预期行为**:
  - 每轮对话都能访问历史
  - 第2轮能正确回忆第1轮内容
- **实际结果**: [记录对话连贯性]

### 8. 边界情况和错误处理测试

#### 8.1 空消息处理
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "" (空字符串)
- **预期行为**: 返回 400 错误,"消息不能为空"
- **实际结果**: [记录错误处理]

#### 8.2 超长消息处理
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: 包含数千字符的超长文本
- **预期行为**: 系统能处理(可能截断),不崩溃
- **实际结果**: [记录处理情况]

#### 8.3 特殊字符处理
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试输入**: "测试特殊字符@#$%^&*()在测试地方"
- **预期行为**: 正确处理特殊字符,不影响功能
- **实际结果**: [记录处理情况]

### 9. Zep 记忆兜底测试

#### 9.1 Zep 语义搜索
- **状态**: ✓ PASS / ✗ FAIL / ⚠ SKIP
- **耗时**: X.XXs
- **前置条件**: Zep 已配置并运行
- **测试流程**:
  1. 进行包含物品信息的对话
  2. 查询该物品(数据库中不存在)
- **预期行为**:
  - 数据库查询失败后
  - 触发 Zep 语义搜索
  - 返回历史对话中的相关信息
- **实际结果**: [记录 Zep 搜索结果]
- **Zep 配置**: [记录 Zep 版本和配置]

### 10. 性能测试

#### 10.1 并发请求处理
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试条件**: 5个并发请求
- **性能指标**:
  - 总耗时: X.XXs
  - 平均响应时间: X.XXs
  - 所有请求成功率: XX%
- **预期标准**:
  - 所有请求成功
  - 平均响应时间 < 5s/请求
- **实际结果**: [记录性能数据]

#### 10.2 响应时间测试
- **状态**: ✓ PASS / ✗ FAIL
- **耗时**: X.XXs
- **测试样本**: 3种不同类型的请求
- **性能指标**:
  - 平均响应时间: X.XXs
  - 最大响应时间: X.XXs
  - 最小响应时间: X.XXs
- **预期标准**:
  - 平均 < 10s
  - 最大 < 15s
- **实际结果**: [记录详细时间]

## 数据一致性验证

### SQLite 数据库
- **items 表记录数**: XX
- **item_history 表记录数**: XX
- **items_fts 表同步**: ✓ 正常 / ✗ 异常
- **索引完整性**: ✓ 正常 / ✗ 异常

### Zep 记忆
- **会话消息数**: XX
- **facts 数量**: XX
- **summary 生成**: ✓ 是 / ✗ 否

### Session History 缓存
- **缓存消息数**: XX
- **最大历史长度**: 10 (配置值)
- **刷新策略**: XX 秒

## 问题和建议

### 发现的问题
1. [问题描述]
   - 严重程度: 高/中/低
   - 影响范围: [描述]
   - 建议修复方案: [描述]

2. [问题描述]
   - ...

### 性能优化建议
1. [建议内容]
2. [建议内容]

### 功能改进建议
1. [建议内容]
2. [建议内容]

## 测试环境信息

- **操作系统**: macOS / Linux / Windows
- **Python 版本**: X.X.X
- **关键依赖版本**:
  - LangChain: X.X.X
  - Flask: X.X.X
  - SQLite: X.X.X
  - Zep SDK: X.X.X (如果使用)
- **硬件配置**:
  - CPU: [型号]
  - 内存: XXG
  - 磁盘: [类型]

## 附录

### 测试命令
```bash
# 启动服务端
uv run youyou-server

# 运行测试脚本
uv run python scripts/test_business_logic.py

# 查看数据库
sqlite3 data/items.db "SELECT * FROM items;"
```

### 关键日志片段
```
[粘贴关键日志]
```

### 测试数据示例
```json
{
  "test_items": [
    {"item": "测试钥匙", "location": "测试桌子"},
    {"item": "测试手机", "location": "测试背包"}
  ]
}
```

---

**报告生成时间**: [YYYY-MM-DD HH:MM:SS]
**报告版本**: v1.0
**报告作者**: [姓名]
